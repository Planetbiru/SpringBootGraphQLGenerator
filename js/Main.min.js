let stringUtil=new StringUtil,generator=new GraphQLSpringGenerator,sqlParser=new SQLParser,util=new GraphQLSchemaUtils,entityRenderer,updatedWidth=600,drawRelationship=!0;function autopopulateDriverAndDialect(e){let t=document.getElementById("dbDriver"),r=document.getElementById("dbDialect");e.startsWith("jdbc:mysql:")?(t.value="com.mysql.cj.jdbc.Driver",r.value="org.hibernate.dialect.MySQL8Dialect"):e.startsWith("jdbc:mariadb:")?(t.value="org.mariadb.jdbc.Driver",r.value="org.hibernate.dialect.MariaDBDialect"):e.startsWith("jdbc:postgresql:")?(t.value="org.postgresql.Driver",r.value="org.hibernate.dialect.PostgreSQLDialect"):e.startsWith("jdbc:sqlite:")?(t.value="org.sqlite.JDBC",r.value="org.hibernate.dialect.SQLiteDialect"):e.startsWith("jdbc:oracle:")?(t.value="oracle.jdbc.OracleDriver",r.value="org.hibernate.dialect.Oracle12cDialect"):e.startsWith("jdbc:sqlserver:")?(t.value="com.microsoft.sqlserver.jdbc.SQLServerDriver",r.value="org.hibernate.dialect.SQLServer2012Dialect"):e.startsWith("jdbc:h2:")?(t.value="org.h2.Driver",r.value="org.hibernate.dialect.H2Dialect"):e.startsWith("jdbc:derby:")?(t.value="org.apache.derby.jdbc.EmbeddedDriver",r.value="org.hibernate.dialect.DerbyDialect"):e.startsWith("jdbc:db2:")?(t.value="com.ibm.db2.jcc.DB2Driver",r.value="org.hibernate.dialect.DB2Dialect"):e.startsWith("jdbc:firebird:")?(t.value="org.firebirdsql.jdbc.FBDriver",r.value="org.hibernate.dialect.FirebirdDialect"):e.startsWith("jdbc:sybase:")&&(t.value="com.sybase.jdbc4.jdbc.SybDriver",r.value="org.hibernate.dialect.SybaseDialect")}function autopopulatePackage(e){let t=document.getElementById("groupId"),r=document.getElementById("artifactId"),i=document.getElementById("serviceName"),a=e.trim();if(!a){t.value="",r.value="",i.value="";return}t.value=a;let l=a.split("."),n=l[l.length-1];r.value=n,i.value=n.split(/[-_]/).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}function applyModel(e){let t=document.getElementById("maxRelationDepth"),r=Math.max(...e.entities.map(e=>e.depth))-1;t.value=r,generator.setModel(e)}let resizeTimeout;function createSelector(e,t){e.innerHTML="",t&&t.entities&&t.entities.forEach(t=>{let r=document.createElement("tr"),i=document.createElement("td"),a=document.createElement("td"),l=document.createElement("td"),n=document.createElement("input");n.setAttribute("type","checkbox"),n.setAttribute("checked","checked"),n.classList.add("selected-entity"),n.value=t.name,i.appendChild(n),a.innerHTML=t.name;let d="",c=t.columns.filter(e=>e.primaryKey);c&&(d=c.map(e=>e.name).join(", ")),l.innerHTML=d,r.appendChild(i),r.appendChild(a),r.appendChild(l),e.appendChild(r)})}window.addEventListener("resize",()=>{clearTimeout(resizeTimeout),resizeTimeout=setTimeout(()=>{let e=document.querySelector(".erd-wrapper"),t=document.querySelector("#entity-selection-body");if(e){let r=e.clientWidth;r<480&&(r=480),entityRenderer.createERD(generator.getModel(),r,drawRelationship),entityRenderer.createDescription(generator.getModel(),"#erd-description"),createSelector(t,generator.getModel())}},30)}),document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("configForm"),t=document.getElementById("packageName"),r=document.getElementById("dbUrl"),i=document.getElementById("sqlFile");(entityRenderer=new EntityRenderer(".erd-svg")).initIconEvent(generator);let a=document.querySelector(".erd-wrapper");a&&(updatedWidth=a.clientWidth),t.addEventListener("change",function(e){autopopulatePackage(e.target.value)}),t.addEventListener("keyup",function(e){autopopulatePackage(e.target.value)}),r.addEventListener("change",function(e){autopopulateDriverAndDialect(e.target.value)}),r.addEventListener("keyup",function(e){autopopulateDriverAndDialect(e.target.value)}),i.addEventListener("change",function(t){let r=new FormData(e),i=r.get("sqlFile");if(i){let a=document.querySelector("#entity-selection-body");sqlParser.importSQLFile(i,e=>{e.entities=e.entities.filter(e=>"sqlite_sequence"!==e.name),applyModel(e),updatedWidth<480&&(updatedWidth=480),entityRenderer.createERD(e,updatedWidth,drawRelationship),entityRenderer.createDescription(e,"#erd-description"),createSelector(a,e)})}});let l=document.querySelector(".check-all");l.checked=!0,l.addEventListener("change",function(){let e=document.querySelectorAll('#entity-selection-body input[type="checkbox"]'),t=this.checked;e.forEach(e=>{e.checked=t})});let n=new FormData(e),d=n.get("sqlFile");if(d){let c=document.querySelector("#entity-selection-body");sqlParser.importSQLFile(d,e=>{e.entities=e.entities.filter(e=>"sqlite_sequence"!==e.name),applyModel(e),updatedWidth<480&&(updatedWidth=480),entityRenderer.createERD(e,updatedWidth,drawRelationship),entityRenderer.createDescription(e,"#erd-description"),createSelector(c,e)})}e.addEventListener("submit",t=>{t.preventDefault();let r=new FormData(e),i={packageName:r.get("packageName"),groupId:r.get("groupId"),artifactId:r.get("artifactId"),serviceName:r.get("serviceName"),serviceDescription:r.get("serviceDescription"),javaVersion:r.get("javaVersion"),version:r.get("version"),maxRelationDepth:parseInt(r.get("maxRelationDepth"))||3},a={entities:[]},l=document.querySelectorAll('#entity-selection-body input[type="checkbox"]');if(l.length){let n=[];l.forEach(e=>{e.checked&&n.push(e.value)});let d=generator.getModel();d&&d.entities&&d.entities.forEach(e=>{n.includes(e.name)&&a.entities.push(e)})}generator.createZipFile(a,i,document.querySelector("#artifactId").value+".zip")})});